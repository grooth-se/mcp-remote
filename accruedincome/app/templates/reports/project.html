{% extends "base.html" %}
{% block title %}Project Revenue Report{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="bi bi-currency-dollar"></i> Project Revenue Report: {{ closing_date }}</h2>
        <hr>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Project</th>
                        <th>Customer</th>
                        <th class="text-end">Expected Income</th>
                        <th class="text-end">Actual Income</th>
                        <th class="text-end">Remaining</th>
                        <th class="text-end">Accrued</th>
                        <th class="text-end">Total Income</th>
                        <th class="text-end">Actual Cost</th>
                        <th class="text-end">Actual Profit</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in projects %}
                    <tr>
                        <td><code>{{ p.project_number }}</code></td>
                        <td>{{ p.customer_name or p.project_name or '-' }}</td>
                        <td class="text-end">{{ "{:,.0f}".format(p.expected_income or 0) }}</td>
                        <td class="text-end">{{ "{:,.0f}".format(p.actual_income_cur or 0) }}</td>
                        <td class="text-end">{{ "{:,.0f}".format(p.remaining_income or 0) }}</td>
                        <td class="text-end text-success">{{ "{:,.0f}".format(p.accrued_income_cur or 0) }}</td>
                        <td class="text-end"><strong>{{ "{:,.0f}".format(p.total_income_cur or 0) }}</strong></td>
                        <td class="text-end text-danger">{{ "{:,.0f}".format(p.actual_cost_cur or 0) }}</td>
                        <td class="text-end {% if (p.project_profit or 0) >= 0 %}text-success{% else %}text-danger{% endif %}">{{ "{:,.0f}".format(p.project_profit or 0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-secondary">
                    <tr>
                        <th colspan="2">TOTAL ({{ projects|length }} projects)</th>
                        <th class="text-end">{{ "{:,.0f}".format(projects|sum(attribute='expected_income') or 0) }}</th>
                        <th class="text-end">{{ "{:,.0f}".format(projects|sum(attribute='actual_income_cur') or 0) }}</th>
                        <th class="text-end">{{ "{:,.0f}".format(projects|sum(attribute='remaining_income') or 0) }}</th>
                        <th class="text-end">{{ "{:,.0f}".format(projects|sum(attribute='accrued_income_cur') or 0) }}</th>
                        <th class="text-end">{{ "{:,.0f}".format(projects|sum(attribute='total_income_cur') or 0) }}</th>
                        <th class="text-end">{{ "{:,.0f}".format(projects|sum(attribute='actual_cost_cur') or 0) }}</th>
                        <th class="text-end">{{ "{:,.0f}".format(projects|sum(attribute='project_profit') or 0) }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="{{ url_for('reports.index', closing_date=closing_date) }}" class="btn btn-outline-primary">
        <i class="bi bi-arrow-left"></i> Back to Reports
    </a>
</div>
{% endblock %}
