{% extends "base.html" %}
{% block title %}Calculation Results{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="bi bi-table"></i> Calculation Results: {{ closing_date }}</h2>
        <hr>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Total Income</h6>
                <h4 class="card-title">{{ "{:,.0f}".format(totals.total_income) }} SEK</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Total Cost</h6>
                <h4 class="card-title">{{ "{:,.0f}".format(totals.total_cost) }} SEK</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card positive">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Total Accrued</h6>
                <h4 class="card-title text-success">{{ "{:,.0f}".format(totals.total_accrued) }} SEK</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Total Contingency</h6>
                <h4 class="card-title text-warning">{{ "{:,.0f}".format(totals.total_contingency) }} SEK</h4>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <i class="bi bi-list"></i> Project Details ({{ projects | length }} projects)
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead class="table-dark">
                    <tr>
                        <th>Project</th>
                        <th>Name</th>
                        <th class="text-end">Total Income</th>
                        <th class="text-end">Total Cost</th>
                        <th class="text-end">Completion %</th>
                        <th class="text-end">Accrued Income</th>
                        <th class="text-end">Contingency</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in projects %}
                    <tr>
                        <td><code>{{ p.project_number }}</code></td>
                        <td>{{ p.project_name or '-' }}</td>
                        <td class="text-end">{{ "{:,.0f}".format(p.total_income_cur or 0) }}</td>
                        <td class="text-end">{{ "{:,.0f}".format(p.total_cost_cur or 0) }}</td>
                        <td class="text-end">{{ "{:.1%}".format(p.completion_cur1 or 0) }}</td>
                        <td class="text-end text-success">{{ "{:,.0f}".format(p.accrued_income_cur or 0) }}</td>
                        <td class="text-end text-warning">{{ "{:,.0f}".format(p.contingency_cur or 0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-secondary">
                    <tr>
                        <th colspan="2">TOTAL</th>
                        <th class="text-end">{{ "{:,.0f}".format(totals.total_income) }}</th>
                        <th class="text-end">{{ "{:,.0f}".format(totals.total_cost) }}</th>
                        <th></th>
                        <th class="text-end text-success">{{ "{:,.0f}".format(totals.total_accrued) }}</th>
                        <th class="text-end text-warning">{{ "{:,.0f}".format(totals.total_contingency) }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
{% endblock %}
