{% extends "base.html" %}
{% block title %}Resultaträkning - Familjekontor{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Resultaträkning</h2>
    <div class="d-flex gap-2">
        <form method="GET">
            <select name="fiscal_year_id" class="form-select form-select-sm" onchange="this.form.submit()">
                {% for fy in form.fiscal_year_id.choices %}
                <option value="{{ fy[0] }}" {% if fy[0] == current_fy_id %}selected{% endif %}>{{ fy[1] }}</option>
                {% endfor %}
            </select>
        </form>
        {% if current_fy_id %}
        <button onclick="window.print()" class="btn btn-sm btn-outline-secondary no-print"><i class="bi bi-printer"></i> Skriv ut</button>
        <a href="{{ url_for('reports.pnl_excel', fiscal_year_id=current_fy_id) }}" class="btn btn-sm btn-outline-success"><i class="bi bi-file-earmark-excel"></i> Excel</a>
        {% endif %}
    </div>
</div>

{% if report %}
<div class="card report-card">
    <div class="card-body">
        <h4 class="text-center">{{ company.name }}</h4>
        <h5 class="text-center text-muted mb-4">Resultaträkning {{ fiscal_year.start_date }} - {{ fiscal_year.end_date }}</h5>

        {% for section_name, section in report.sections.items() %}
        <h6 class="mt-3">{{ section_name }}</h6>
        <div class="table-responsive">
        <table class="table table-sm">
            <tbody>
                {% for account, balance in section.accounts %}
                {% if balance|abs > 0.01 %}
                <tr>
                    <td style="width:10%">{{ account.account_number }}</td>
                    <td>{{ account.name }}</td>
                    <td class="text-end" style="width:20%">{{ balance|sek }}</td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="table-light">
                    <td colspan="2"><strong>Summa {{ section_name }}</strong></td>
                    <td class="text-end"><strong>{{ section.total|sek }}</strong></td>
                </tr>
            </tfoot>
        </table>
        </div>
        {% endfor %}

        <div class="table-responsive">
        <table class="table table-sm mt-3">
            <tbody>
                <tr class="table-primary">
                    <td><strong>Rörelseresultat</strong></td>
                    <td class="text-end"><strong>{{ report.operating_result|sek }}</strong></td>
                </tr>
                <tr class="table-info">
                    <td><strong>Resultat före skatt</strong></td>
                    <td class="text-end"><strong>{{ report.result_before_tax|sek }}</strong></td>
                </tr>
            </tbody>
        </table>
        </div>
    </div>
</div>
{% else %}
<div class="alert alert-info">Välj ett räkenskapsår för att visa rapporten.</div>
{% endif %}
{% endblock %}
