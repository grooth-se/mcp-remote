{% extends "base.html" %}
{% block title %}Balansräkning - Familjekontor{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Balansräkning</h2>
    <div class="d-flex gap-2">
        <form method="GET">
            <select name="fiscal_year_id" class="form-select form-select-sm" onchange="this.form.submit()">
                {% for fy in form.fiscal_year_id.choices %}
                <option value="{{ fy[0] }}" {% if fy[0] == current_fy_id %}selected{% endif %}>{{ fy[1] }}</option>
                {% endfor %}
            </select>
        </form>
        {% if current_fy_id %}
        <button onclick="window.print()" class="btn btn-sm btn-outline-secondary no-print"><i class="bi bi-printer"></i> Skriv ut</button>
        <a href="{{ url_for('reports.balance_excel', fiscal_year_id=current_fy_id) }}" class="btn btn-sm btn-outline-success"><i class="bi bi-file-earmark-excel"></i> Excel</a>
        {% endif %}
    </div>
</div>

{% if report %}
<div class="card report-card">
    <div class="card-body">
        <h4 class="text-center">{{ company.name }}</h4>
        <h5 class="text-center text-muted mb-4">Balansräkning per {{ fiscal_year.end_date }}</h5>

        <h5>TILLGÅNGAR</h5>
        {% for section_name in ['Anläggningstillgångar', 'Omsättningstillgångar'] %}
        {% set section = report.sections[section_name] %}
        <h6>{{ section_name }}</h6>
        <div class="table-responsive">
        <table class="table table-sm">
            <tbody>
                {% for account, balance in section.accounts %}
                {% if balance|abs > 0.01 %}
                <tr>
                    <td style="width:10%">{{ account.account_number }}</td>
                    <td>{{ account.name }}</td>
                    <td class="text-end" style="width:20%">{{ "%.2f"|format(balance) }}</td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="table-light">
                    <td colspan="2"><strong>Summa {{ section_name }}</strong></td>
                    <td class="text-end"><strong>{{ "%.2f"|format(section.total) }}</strong></td>
                </tr>
            </tfoot>
        </table>
        </div>
        {% endfor %}

        <div class="table-responsive">
        <table class="table table-sm">
            <tr class="table-primary">
                <td><strong>SUMMA TILLGÅNGAR</strong></td>
                <td class="text-end"><strong>{{ "%.2f"|format(report.total_assets) }}</strong></td>
            </tr>
        </table>
        </div>

        <h5 class="mt-4">EGET KAPITAL OCH SKULDER</h5>
        {% for section_name in ['Eget kapital', 'Långfristiga skulder', 'Kortfristiga skulder'] %}
        {% set section = report.sections[section_name] %}
        <h6>{{ section_name }}</h6>
        <div class="table-responsive">
        <table class="table table-sm">
            <tbody>
                {% for account, balance in section.accounts %}
                {% if balance|abs > 0.01 %}
                <tr>
                    <td style="width:10%">{{ account.account_number }}</td>
                    <td>{{ account.name }}</td>
                    <td class="text-end" style="width:20%">{{ "%.2f"|format(balance) }}</td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="table-light">
                    <td colspan="2"><strong>Summa {{ section_name }}</strong></td>
                    <td class="text-end"><strong>{{ "%.2f"|format(section.total) }}</strong></td>
                </tr>
            </tfoot>
        </table>
        </div>
        {% endfor %}

        <div class="table-responsive">
        <table class="table table-sm">
            <tr class="table-info">
                <td><strong>SUMMA EGET KAPITAL OCH SKULDER</strong></td>
                <td class="text-end"><strong>{{ "%.2f"|format(report.total_equity_liabilities) }}</strong></td>
            </tr>
        </table>
        </div>
    </div>
</div>
{% else %}
<div class="alert alert-info">Välj ett räkenskapsår för att visa rapporten.</div>
{% endif %}
{% endblock %}
