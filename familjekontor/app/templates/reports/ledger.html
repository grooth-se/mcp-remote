{% extends "base.html" %}
{% from "macros/breadcrumbs.html" import render_breadcrumbs %}
{% block title %}Huvudbok - PsalmGears{% endblock %}
{% block breadcrumbs %}
{{ render_breadcrumbs([
    {'title': 'Start', 'url': url_for('dashboard.index')},
    {'title': 'Rapporter'},
    {'title': 'Huvudbok'}
]) }}
{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Huvudbok</h2>
    <div class="d-flex gap-2">
        <form method="GET" class="d-flex gap-2">
            <select name="fiscal_year_id" class="form-select form-select-sm">
                {% for fy in form.fiscal_year_id.choices %}
                <option value="{{ fy[0] }}" {% if fy[0] == current_fy_id %}selected{% endif %}>{{ fy[1] }}</option>
                {% endfor %}
            </select>
            <input type="text" name="account_number" class="form-control form-control-sm" placeholder="Konto (valfritt)" value="{{ account_number }}" style="width: 120px;">
            <button class="btn btn-sm btn-primary">Visa</button>
        </form>
        {% if current_fy_id %}
        <button onclick="window.print()" class="btn btn-sm btn-outline-secondary no-print"><i class="bi bi-printer"></i> Skriv ut</button>
        <a href="{{ url_for('reports.ledger_excel', fiscal_year_id=current_fy_id, account_number=account_number) }}" class="btn btn-sm btn-outline-success"><i class="bi bi-file-earmark-excel"></i> Excel</a>
        {% endif %}
    </div>
</div>

{% if ledger %}
{% for key, data in ledger.items() %}
<div class="card mb-3">
    <div class="card-header">
        <strong>{{ data.account_number }}</strong> {{ data.account_name }}
    </div>
    <div class="table-responsive">
        <table class="table table-sm mb-0">
            <thead><tr><th>Datum</th><th>Ver.nr</th><th>Beskrivning</th><th class="text-end">Debet</th><th class="text-end">Kredit</th></tr></thead>
            <tbody>
                {% for entry in data.entries %}
                <tr>
                    <td>{{ entry.date }}</td>
                    <td>{{ entry.verification_number }}</td>
                    <td>{{ entry.description }}</td>
                    <td class="text-end">{{ entry.debit|sek if entry.debit else '' }}</td>
                    <td class="text-end">{{ entry.credit|sek if entry.credit else '' }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="table-light">
                    <td colspan="3"><strong>Saldo</strong></td>
                    <td class="text-end"><strong>{{ data.total_debit|sek }}</strong></td>
                    <td class="text-end"><strong>{{ data.total_credit|sek }}</strong></td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
{% endfor %}
{% elif current_fy_id %}
<div class="alert alert-info">Inga transaktioner hittades.</div>
{% else %}
<div class="alert alert-info">Välj ett räkenskapsår för att visa huvudboken.</div>
{% endif %}
{% endblock %}
