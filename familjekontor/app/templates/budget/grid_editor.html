{% extends "base.html" %}
{% block title %}Budgeteditor - Familjekontor{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-grid-3x3"></i> Budgeteditor {{ fy.year if fy else '' }}</h2>
    <div>
        <button id="saveBtn" class="btn btn-success" onclick="saveBudget()">
            <i class="bi bi-save"></i> Spara
        </button>
        <a href="{{ url_for('budget.grid_excel', fiscal_year_id=fy.id if fy else '') }}" class="btn btn-outline-secondary">
            <i class="bi bi-file-earmark-excel"></i> Exportera Excel
        </a>
    </div>
</div>

<div id="saveStatus" class="alert alert-success d-none mb-3">Budget sparad!</div>

<div class="card">
    <div class="table-responsive">
        <table class="table table-sm table-bordered mb-0" id="budgetGrid">
            <thead class="table-light">
                <tr>
                    <th style="min-width:80px">Konto</th>
                    <th style="min-width:150px">Namn</th>
                    {% for m in range(1, 13) %}
                    <th class="text-center" style="min-width:90px">{{ ['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'][m-1] }}</th>
                    {% endfor %}
                    <th class="text-end" style="min-width:100px">Totalt</th>
                </tr>
            </thead>
            <tbody>
                {% for acc_id, data in grid.items() %}
                <tr data-account-id="{{ acc_id }}">
                    <td><strong>{{ data.number }}</strong></td>
                    <td>{{ data.name }}</td>
                    {% for m in range(1, 13) %}
                    <td>
                        <input type="number" class="form-control form-control-sm budget-input"
                               data-account="{{ acc_id }}" data-month="{{ m }}"
                               value="{{ data.months[m] if data.months[m] else '' }}"
                               step="0.01" style="width:85px">
                    </td>
                    {% endfor %}
                    <td class="text-end fw-bold row-total">{{ data.total|sek(0) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/budget_grid.js') }}"></script>
{% endblock %}
