{% extends "base.html" %}
{% block title %}Ny leverantörsfaktura - Familjekontor{% endblock %}
{% block content %}
<h2 class="mb-4">Ny leverantörsfaktura</h2>

<div class="row">
    <div class="col-lg-10">
        {# CSRF token for AJAX requests #}
        <input type="hidden" id="csrfToken" name="csrf_token" value="{{ csrf_token() }}">

        {# Step 1: PDF Upload #}
        <div class="card mb-4">
            <div class="card-header"><i class="bi bi-file-earmark-pdf"></i> Steg 1: Ladda upp faktura-PDF</div>
            <div class="card-body">
                <div class="drop-zone" id="invoiceDropZone">
                    <i class="bi bi-cloud-arrow-up fs-1 text-muted"></i>
                    <p class="mt-2 mb-0">Dra och släpp faktura-PDF här, eller klicka för att välja</p>
                    <small class="text-muted">Systemet läser PDF:en och fyller i fälten automatiskt</small>
                </div>
                <div id="analyzeStatus" class="mt-2" style="display:none;"></div>
            </div>
        </div>

        {# Step 2: Form #}
        <div class="card">
            <div class="card-header"><i class="bi bi-pencil-square"></i> Steg 2: Granska och komplettera</div>
            <div class="card-body">
                <form method="POST" id="invoiceForm" enctype="multipart/form-data">
                    {{ form.hidden_tag() }}
                    <div class="row mb-3">
                        <div class="col-md-8">
                            {{ form.supplier_id.label(class="form-label") }}
                            {{ form.supplier_id(class="form-select", id="supplier_id") }}
                        </div>
                        <div class="col-md-4">
                            {{ form.invoice_number.label(class="form-label") }}
                            {{ form.invoice_number(class="form-control", id="invoice_number") }}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            {{ form.invoice_date.label(class="form-label") }}
                            {{ form.invoice_date(class="form-control", type="date", id="invoice_date") }}
                        </div>
                        <div class="col-md-4">
                            {{ form.due_date.label(class="form-label") }}
                            {{ form.due_date(class="form-control", type="date", id="due_date") }}
                        </div>
                        <div class="col-md-4">
                            {{ form.currency.label(class="form-label") }}
                            {{ form.currency(class="form-select", id="currency") }}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            {{ form.amount_excl_vat.label(class="form-label") }}
                            {{ form.amount_excl_vat(class="form-control", id="amount_excl_vat") }}
                        </div>
                        <div class="col-md-4">
                            {{ form.vat_amount.label(class="form-label") }}
                            {{ form.vat_amount(class="form-control", id="vat_amount") }}
                        </div>
                        <div class="col-md-4">
                            {{ form.total_amount.label(class="form-label") }}
                            {{ form.total_amount(class="form-control", id="total_amount") }}
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        {{ form.submit(class="btn btn-primary") }}
                        <a href="{{ url_for('invoices.supplier_invoices') }}" class="btn btn-secondary">Avbryt</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/invoice_pdf_upload.js') }}"></script>
{% endblock %}
