{% extends "base.html" %}
{% from "macros/pagination.html" import render_pagination, sortable_header %}
{% from "macros/breadcrumbs.html" import render_breadcrumbs %}
{% block title %}Kunder - PsalmGears{% endblock %}
{% block breadcrumbs %}
{{ render_breadcrumbs([
    {'title': 'Start', 'url': url_for('dashboard.index')},
    {'title': 'Bokföring', 'url': url_for('accounting.index')},
    {'title': 'Kunder'}
]) }}
{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Kunder</h2>
    <a href="{{ url_for('invoices.new_customer') }}" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Ny kund</a>
</div>
<form class="mb-3" method="GET">
    <input type="hidden" name="sort" value="{{ sort }}">
    <input type="hidden" name="order" value="{{ order }}">
    <div class="input-group input-group-sm" style="max-width:400px;">
        <input type="text" name="search" class="form-control" placeholder="Sök namn eller org.nr..." value="{{ search }}">
        <button class="btn btn-outline-secondary" type="submit"><i class="bi bi-search"></i></button>
        {% if search %}<a href="{{ url_for('invoices.customers') }}" class="btn btn-outline-secondary">Rensa</a>{% endif %}
    </div>
</form>
<div class="table-responsive">
    <table class="table table-hover">
        <thead><tr>
            {{ sortable_header('Namn', 'name', sort, order, 'invoices.customers', search=search) }}
            {{ sortable_header('Org.nr', 'org_number', sort, order, 'invoices.customers', search=search) }}
            <th>Land</th><th>Ort</th><th>Valuta</th>
            {{ sortable_header('Betvillkor', 'payment_terms', sort, order, 'invoices.customers', search=search) }}
        </tr></thead>
        <tbody>
            {% for c in pagination.items %}
            <tr>
                <td>{{ c.name }}</td>
                <td>{{ c.org_number or '-' }}</td>
                <td>{{ c.country }}</td>
                <td>{{ c.city or '-' }}</td>
                <td>{{ c.default_currency }}</td>
                <td>{{ c.payment_terms }} dagar</td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="text-center text-muted py-4">Inga kunder. <a href="{{ url_for('invoices.new_customer') }}">Lägg till kund</a></td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{{ render_pagination(pagination, 'invoices.customers', search=search, sort=sort, order=order) }}
{% endblock %}
